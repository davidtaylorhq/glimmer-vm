<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Glimmer Test Suite</title>
</head>

<body>
  <script>
    if (typeof console === 'undefined') {
      console = {
        log: function () { },
        warn: function () { },
        error: function () { },
        group: function () { },
        groupEnd: function () { },
      };
    }
  </script>

  <div id="qunit">
  </div>
  <div id="qunit-fixture"></div>
  <script type="module">
    import "qunit";
    import "qunit/qunit/qunit.css";

    QUnit.config.autostart = false;
    globalThis.QUnit = QUnit;

    // since all of our tests are synchronous, the QUnit
    // UI never has a chance to rerender / update. This
    // leads to a very long "white screen" when running
    // the tests
    //
    // this adds a very small amount of async, just to allow
    // the QUnit UI to rerender once per module completed
    {
      const pause  = () => new Promise((res) => {
        setTimeout(res, 10);
      });

      let start = performance.now();
      QUnit.testDone(function (test) {
        var gap = performance.now() - start;
        if (gap > 100) {
          return pause();
        }
      });

      QUnit.moduleDone(function () {
        // breathe after module
        return pause();
      });
    }
  </script>
  <script type="module">
    const packages =  await import.meta.glob("./packages/@glimmer/*/test/**/*-test.ts");

    for (const pkg of Object.values(packages)) {
      await pkg();
    }

    QUnit.start();

  </script>

</body>

</html>
